<!DOCTYPE html>
<html>
<head>
	<title>GPS Speedometer</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		#speed {
			font-size: 2em;
			text-align: center;
			margin-top: 50px;
		}
	</style>
</head>
<body>
	<div id="speed">Calculating speed...</div>
	<script>var distance = 0;
var altitude = 0;
var prevPosition = null;
var recording = false;

function startRecording() {
	recording = true;
	prevPosition = null;
	distance = 0;
	altitude = 0;
	document.getElementById("distance").innerHTML = "0 m";
	document.getElementById("altitude").innerHTML = "0 m";
}

function stopRecording() {
	recording = false;
}

if (navigator.geolocation) {
	navigator.geolocation.watchPosition(function(position) {
		var speed = position.coords.speed;
		var alt = position.coords.altitude;
		if (speed === null) {
			document.getElementById("speed").innerHTML = "Speed data not available";
		} else {
			document.getElementById("speed").innerHTML = (speed * 3.6).toFixed(2) + " km/h";
		}
		if (alt === null) {
			document.getElementById("altitude").innerHTML = "Altitude data not available";
		} else {
			document.getElementById("altitude").innerHTML = alt.toFixed(2) + " m";
		}
		if (recording) {
			if (prevPosition !== null) {
				var dist = getDistanceFromLatLonInM(prevPosition.coords.latitude, prevPosition.coords.longitude, position.coords.latitude, position.coords.longitude);
				distance += dist;
				document.getElementById("distance").innerHTML = distance.toFixed(2) + " m";
				var altDiff = position.coords.altitude - prevPosition.coords.altitude;
				altitude += Math.abs(altDiff);
				document.getElementById("altitude-change").innerHTML = altitude.toFixed(2) + " m";
			}
			prevPosition = position;
		}
	}, function(error) {
		document.getElementById("speed").innerHTML = "Error getting speed data: " + error.message;
		document.getElementById("altitude").innerHTML = "Error getting altitude data: " + error.message;
	});
} else {
	document.getElementById("speed").innerHTML = "Geolocation not supported";
	document.getElementById("altitude").innerHTML = "Geolocation not supported";
}

function getDistanceFromLatLonInM(lat1, lon1, lat2, lon2) {
	var R = 6371e3; // metres
	var φ1 = lat1 * Math.PI / 180;
	var φ2 = lat2 * Math.PI / 180;
	var Δφ = (lat2 - lat1) * Math.PI / 180;
	var Δλ =
			navigator.geolocation.watchPosition(function(position) {
				var speed = position.coords.speed;
				if (speed === null) {
					document.getElementById("speed").innerHTML = "Speed data not available";
				} else {
					document.getElementById("speed").innerHTML = speed.toFixed(2) + " m/s";
				}
			}, function(error) {
				document.getElementById("speed").innerHTML = "Error getting speed data: " + error.message;
			});
		} else {
			document.getElementById("speed").innerHTML = "Geolocation not supported";
		}
	</script>
</body>
</html>
